---
alwaysApply: false
---

# Level 4 Workflow: Complex System

Level 4 tasks are too large to plan and execute in one pass. They are composed of multiple L1/L2/L3 sub-runs, each corresponding to a milestone. Complexity analysis manages the milestone list and routes each sub-run to the appropriate level workflow. There are no dedicated Level 4 plan or build phases â€” those happen inside each sub-run at its own level.

## Workflow Overview

```mermaid
graph TD

    Start(("Complexity Analysis"))
    CheckIfMilestones{"memory-bank/milestones.md<br>exists?"}

    subgraph Init["First L4 Run"]
        NikoPlan["ðŸ˜º plan<br>(generate milestones)"]
        NikoPreflight{"ðŸ˜º preflight"}
        ManualReview["ðŸ§‘â€ðŸ’» review plan"]
    end

    subgraph ReEntry["L4 Milestone Management"]
        CheckMilestoneCompletion{"All milestones complete?"}
        Capstone[/"ðŸ§‘â€ðŸ’» /niko-archive (capstone)"/]
        Capstone -->Done("Done")
        PrevDone{"activeContext shows<br>REFLECT COMPLETE?"}
        CheckOff["Check off completed<br>milestone in milestones.md"]
        Resume["Load context<br>prepare to re-enter workflow"]
    end

    subgraph SubWorkflow["L1-L3 Milestone Execution"]
        NextSub(("ðŸ˜º Complexity Analysis<br>Classify next unchecked<br>milestone as L1/L2/L3"))
        SubRun("ðŸ˜º Run L1/L2/L3 workflow")
    end

    Start --> CheckIfMilestones

    CheckIfMilestones -->|"No"| NikoPlan
    NikoPlan --> NikoPreflight
    NikoPreflight -->|"FAIL"| NikoPlan

    NikoPreflight -.->|"PASS"| ManualReview
    ManualReview -.->|"ðŸ§‘â€ðŸ’» /niko"| Start

    CheckIfMilestones -->|"Yes"| CheckMilestoneCompletion
    CheckMilestoneCompletion -.->|"Yes"| Capstone

    CheckMilestoneCompletion -->|"No"| PrevDone
    PrevDone --"Yes"--> CheckOff
    CheckOff --> NextSub

    PrevDone --"No"--> Resume
    Resume --> SubRun

    NextSub --> SubRun
    SubRun -.->|"Sub-run reflect complete<br>ðŸ§‘â€ðŸ’» /niko"| Start
```

> Legend:
> - ðŸ± = Phase executed autonomously
> - ðŸ§‘â€ðŸ’» = Phase initiated by operator with explicit command
> - Solid edge = Transition does not require operator input
> - Dashed edge = Transition requires operator input

The following require operator input; if you have arrived at one of these transitions, STOP and wait:

- Sub-run reflect complete â†’ next `/niko` invocation (operator decides when to continue)
- All milestones checked â†’ capstone archive (operator invokes `/niko-archive`)
- Initial L4 milestone generation â†’ first workflow execution (operator invokes `/niko`)

## Change Tracking

ðŸš¨ **CRITICAL:** Before entering a new phase, you MUST update `memory-bank/progress.md` and commit all changes to source control:

1. Update `memory-bank/progress.md` to indicate completion of the phase you are leaving.
2. Commit all changes - memory bank *and* other resources - to source control using a conventional commit in the following format: `chore: saving work before [phase] phase`.

## Phase Mappings

To execute a phase for a level 4 task:

1. Update `memory-bank/progress.md` to indicate completion of the phase you are leaving.
2. Commit all changes - memory bank *and* other resources - to source control using a conventional commit in the following format: `chore: saving work before [phase] phase`.
3. Read and follow the instructions in the appropriate locations:
    - **Level 4 Plan Phase**: Load `.cursor/rules/shared/niko/level4/level4-plan.mdc`
    - **Level 4 Preflight Phase**: Invoke the `niko-preflight` skill
    - **Level 4 Archive Phase**: Load `.cursor/rules/shared/niko/level4/level4-archive.mdc`
